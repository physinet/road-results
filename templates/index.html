<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>BikeRank</title>

  <!-- Bootstrap core CSS -->
  <link href="{{ url_for('static', filename='vendor/bootstrap/css/bootstrap.min.css') }}" rel="stylesheet">
  <link href="{{ url_for('static', filename='vendor/boxicons/css/boxicons.min.css') }}" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="{{ url_for('static', filename='css/scrolling-nav.css') }}" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.devbridge-autocomplete/1.2.26/jquery.autocomplete.min.js"></script>

<!-- For altair -->
 <script src="https://cdn.jsdelivr.net/npm/vega@5.17.0"></script>
 <script src="https://cdn.jsdelivr.net/npm/vega-lite@4.17.0"></script>
 <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.12.2"></script>

  <!-- Icon -->
  <link href="data:image/x-icon;base64,AAABAAEAEBAAAAAAAABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABYZHesXGh//Fxof/xcaH/4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAXGh/+Fxof/xcaH/8WGR3rAAAAABYZHvUAAAAAAAAAAAAAAAAAAAAAFxof/wAAAAAAAAAAAwMEFAAAAAAXGh//AAAAAAAAAAAAAAAAAAAAABYZHvUXGh//AAAAAAAAAAAAAAAAAAAAAA8RFZcAAAAAAAAAABcaH/8XGh//Fxof/w8RFZIAAAAAAAAAAAAAAAAXGh//Fxof/wAAAAAAAAAAFxof/wAAAAASFBiwAAAAABcaH/8UFxvaAAAAABETF6QAAAAAFxof/wAAAAAAAAAAFxof/xUXHNkAAAAAAAAAAAAAAAAXGh/+Fxof/xcaH/8AAAAAAAAAABYZHukXGh//DhIVhAAAAAAAAAAAAAAAABUXHNkAAAAAERMXnhcaH/8XGh//Fxof/hcaH/8AAAAAAAAAAAAAAAAXGh//AAAAABYZHvwXGh//Fxof/xETFp4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAXGR7yFxoe8RUYHfAVGB3uFRgd7g0OEnUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFxof/wAAAAAAAAAAAAAAABcaH/8XGh//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABcaH/4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AAD//wAA//8AAIfhAAB73gAAew4AAGpWAABxjgAAg6EAAPg/AAD7nwAA+/8AAP//AAD//wAA//8AAA==" rel="icon" type="image/x-icon" />
  </head>

<body id="page-top">


  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" id="mainNav">
    <div class="container">
      <a class="navbar-brand js-scroll-trigger" href="#page-top">BikeRank</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#about">About</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#race">Find a race</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#racer">Find a racer</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#trueskill">Ratings</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#contact">Contact</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>


  <header class="jumbotron jumbotron-fluid text-white" style="margin: 0; background: url('static/background.jpg') no-repeat center; background-size: cover;">
    <br>
    <br>
    <br>

    <div class="container text-center col-lg-6" style="-moz-border-radius:10px; -webkit-border-radius:10px; border-radius:10px; background: #000; background-color: rgba(0,0,0,0.5)">
      <br>
      <br>
      <h1>BikeRank</h1>
      <h3>Skill ratings for amateur road cyclists</h3>
      <br>
      <p class="lead">Explore your racing history</p>
      <p class="lead">Visualize your progress</p>
      <p class="lead">Get to know your competition</p>
      <p class="lead">Anticipate your results</p>
      <br>
      <br>
    </div>
  </header>

  <section id="about" class="bg-light">



    <div class="container">
      <div class="container col-lg-8">
        <h2 class="text-center">About this project</h2>
        <p style="font-size: 14pt;">
          <b> What is BikeRank? </b><br>
          BikeRank assigns skill ratings to amateur road cyclists based on their performance in races over time.
          <br>
          <br>
          <b> Why should we rate cyclists? </b><br>
          These skill ratings will help racers prepare for future races
           by allowing them to compare their rating with those of the other
           registrants of an upcoming race.
          The ratings could also potentially be used to categorize racers by skill level
          to establish fair but challenging races for equally-matched racers, as an alternative to the existing
          <a href="https://usacycling.org/about-us/governance/policy-viii#roadupgrades">racing category</a> system.
          <br>
          <br>
          <b> How do other points systems fall short? </b><br>
          Existing points-based rating systems for road racing, including those from
          <a href="https://legacy.usacycling.org/news/user/story.php?id=6998">USA Cycling</a>
          and <a href="https://www.road-results.com/?n=talk&sn=f">BikeReg</a>,
          do not fully account for each racer's racing history and lack
          statistical predictions for the outcomes of future races.
          <br>
          <br>
          <b> How does BikeRank assign ratings? </b><br>
          BikeRank adopts the <a href="https://www.microsoft.com/en-us/research/project/trueskill-ranking-system/">TrueSkill™ Ranking System</a>,
          a rating system developed initially for multiplayer online gaming.
          Every cyclist is assigned an initial skill rating, which is updated based on
          the outcomes of races occurring over time.
          The combination of the final placing and previous skill rating for each racer
          determines the amount by which each racer's rating changes.
          Learn more about the ratings <a class="js-scroll-trigger" href="#trueskill">below</a>.
          <br>
          <br>
          <b> How accurate are the ratings? </b><br>
          We evaluate the validity of the ratings using the Spearman correlation, which evaluates the relationship between the assigned skill ratings and actual final placing for racers in each race.
          Though it is impossible to predict races with certainty, the rating system consistently predicts the overall relationship between the relative skill between racers and their placing in a given race (average Spearman correlation around -0.5).
          For more information, see <a class="js-scroll-trigger" href="#trueskill">below</a>.
          <br>
          <br>
          <b> Where do the results come from? </b><br>
          The ratings take into consideration {{ '{:,d}'.format(counts['Results']) }} results from {{ '{:,d}'.format(counts['Races']) }}
          races reported on <a href="https://results.bikereg.com/">BikeReg</a>.
          The results span the years 2006-2020 and mostly consist of races held in the United States.
          <br>
          <div class="container text-center col-lg-12">
            <img src="https://results.bikereg.com/img/bikeRegLogo.png" class=".mx-auto .d-block" style="height:50px;">
            <img src="https://results.bikereg.com/img/roadresultslogo_notag.png" class=".mx-auto .d-block" style="height:50px;">
           </div>
        </p>
      </div>


  </section>


    <section id="race">
      <div class="container">
        <div class="col-lg-10 mx-auto">
          <h2 style="text-align:center;">Find a race</h2>
          Find a race using the search box below. Unfamiliar with bike racing? Try these suggestions:
          <ul>
            <li>Hollenbeck's Spring Classic Road Race (2019-05-05)</li>
            <li>Green Mountain Stage Race - Road Race (2019-09-01)</li>
            <li>Bristol Mountain Road Race (2019-06-02)</li>
          </ul>
          Or, you can browse for a race <a href="https://results.bikereg.com/?n=results&sn=all">here</a>.
          <br>
          <br>
        </div>
          <div class="container text-center">
            <form method="POST" style="text-align:center;">
              {{ race_form.csrf_token }}
              {{ race_form.name_date(size=60, placeholder=race_form.name_date.description) }}
              {{ race_form.submit }}
              <script>
              $('#name_date').autocomplete({
                  serviceUrl: '/search/race_name',
                  dataType: 'json',
                  lookupLimit: 5,
                  minChars: 0,
                  onSearchComplete: function (query, suggestions) {
                    console.log(query);
                  }
              });
              </script>
            </form>
          </div>


          <br>
          <br>

          <h5 style="text-align: center">
            {{ race_name }} • {{ race_date.strftime('%B %d, %Y') }} • Category: {{ category_name }}
          </h5>
            <form class="form-horizontal" style="text-align:center;" method="POST">
                          <b>
                            Select another category:
                          </b>
                          {{ category_form.csrf_token }}
                          {{ category_form.category }}
                          {{ category_form.submit }}
                        </form>

          <div class="col-lg-10 mx-auto text-center">
            <div class="table" style="margin-bottom:300px;">
              <table class="table table-bordered table-sm table-hover table-scroll">
                <thead class="thead-dark">
                  <tr>
                    <th style="text-align: center; width: 15%" scope="col">Name</th>
                    <th style="text-align: center; width: 21%" scope="col">Team</th>
                    <th style="text-align: center; width: 12%" scope="col">Prior Rating (μ ± σ)</th>
                    <th style="text-align: center; width: 10%" scope="col">Predicted Place</th>
                    <th style="text-align: center; width: 10%" scope="col">Actual Place</th>
                    <th style="text-align: center; width: 12%" scope="col">New Rating (μ ± σ)</th>
                    <th style="text-align: center; width: 10%" scope="col">Rating Change</th>
                  </tr>
                </thead>
                <tbody>
                  {% for row in race_table %}
                  <tr>
                    <td style="text-align: center; width: 15%;">{{ row['Name'] }}</td>
                    <td style="text-align: center; width: 21%;">{{ row['TeamName'] }}</td>
                    <td style="text-align: center; width: 12%;">
                      {% if row['prior_mu'] is not none %}
                        {% if row['prior_mu'] == 25 %}
                          <i>{{ '(%.2f ± %.2f)' | format(row['prior_mu'], row['prior_sigma']) }}</i>
                        {% else %}
                          {{ '%.2f ± %.2f' | format(row['prior_mu'], row['prior_sigma']) }}
                        {% endif %}
                      {% else %}
                        NONE
                      {% endif %}
                    </td>
                    <td style="text-align: center; width: 10%;">{{ row['predicted_place'] }}</td>
                    <td style="text-align: center; width: 10%;">{{ row['Place'] | default('DNF', True) }}</td>
                    <td style="text-align: center; width: 12%;">
                      {% if row['Place'] is not none %}
                        {{ '%.2f ± %.2f' | format(row['mu'], row['sigma']) }}
                      {% else %}
                        -
                      {% endif %}
                    </td>
                    <td style="text-align: center; width: 10%;">
                      {% if row['Place'] is not none %}
                        {% if row['mu'] - row['prior_mu'] > 0 %}
                          <span style="color:green;">
                        {% elif row['mu'] == row['prior_mu'] %}
                          <span style="color:black;">
                        {% else %}
                          <span style="color:red;">
                        {% endif %}
                        {{ '%.2f' | format(row['mu'] - row['prior_mu']) }}
                        </span>
                      {% else %}
                        -
                      {% endif %}
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
          </div>
        </div>
        <div class="col-lg-10 mx-auto">
          <br>
          <br>
          <br>
          <br>
          <br>
          <b>What's in this table?</b>
          <ul>
            <li>The table shows the final results from the selected race, in order of final finishing place (DNF = "Did Not Finish").</li>
            <li>The skill ratings for each racer are represented as an average rating ± ("plus or minus") some uncertainty in that rating.</li>
            <li>The Prior Ratings, ranked in order from highest to lowest, determine the Predicted Place for each racer.</li>
            <li>If a racer has not yet competed in the race, they are assigned an initial rating, represented in <i>(parenthesized italics)</i>.</li>
            <li>The New Rating is the result of applying the <a class="js-scroll-trigger" href="#trueskill">rating system</a> to the results.</li>
            <li>The Rating Change is the <span style="color:green;">increase</span> or <span style="color:red;">decrease</span> for each average skill rating as a result of the race.</li>
            <li>The New Ratings account for the performance of each racer relative to the historical performance of <i>all other</i> racers.</li>
          </ul>
          <br>
          <br>
        </div>
      </div>
    </section>

  <section id="racer"   class="bg-light">
    <div class="container">
      <div class="row">
        <div class="col-lg-10 mx-auto">
          <h2 style="text-align:center;">Find a racer</h2>
          Find a racer using the search box below. Don't know any cyclists? Shame on you. Try one of these:
          <ul>
            <li>Brian Schaefer (the author)</li>
            <li>Jeremy Powers</li>
            <li>Colby Lange</li>
          </ul>
          Or, find a racer <a href="https://results.bikereg.com/?n=racers&sn=find">here</a>.
        </div>
        <br>
          <div class="container text-center">
            <form method="POST">
              {{ racer_form.csrf_token }}
              {{ racer_form.racer_name(size=30, placeholder=racer_form.racer_name.description) }}
              {{ racer_form.submit }}
              <script>
              $('#racer_name').autocomplete({
                  serviceUrl: '/search/racer_name',
                  dataType: 'json',
                  lookupLimit: 5,
                  minChars: 0,
                  onSearchComplete: function (query, suggestions) {
                    console.log(query);
                  }
              });
              </script>
            </form>
          </div>
        <br>
        <div class="col-lg-10 mx-auto">
          <br>
          The following table shows a record of races finished by the selected racer (DNF = "Did Not Finish"), in reverse chronological order.</li>
          <br>
          <br>
        </div>

        <div class="container">
          <div class="col-lg-10 mx-auto">
            <h5 style="text-align: center"><br>Race history for {{ racer_name }}:</h5>
            <div class="table-responsive" style="margin-bottom:400px;">
              <table class="table table-bordered table-sm table-hover table-scroll">
                <thead class="thead-dark">
                  <tr>
                    <th style="text-align: center; width: 10%" scope="col">#</th>
                    <th style="text-align: center; width: 20%" scope="col">Date</th>
                    <th style="text-align: center; width: 30%" scope="col">Race Name</th>
                    <th style="text-align: center; width: 20%" scope="col">Category</th>
                    <th style="text-align: center; width: 10%" scope="col">Place</th>
                  </tr>
                </thead>
                <tbody>
                  {% for row in racer_table[::-1] %}
                  <tr>
                    <th style="text-align: center; width: 10%;" scope="row">{{ racer_table|length + 1 - loop.index }}</th>
                    <th style="text-align: center; width: 20%;" scope="row">{{ row['date'].strftime('%B %d, %Y') }}</th>
                    <td style="width: 30%;">{{ row['RaceName'] }}</td>
                    <td style="width: 20%;">{{ row['RaceCategoryName'] }}</td>
                    <td style="text-align: center; width: 10%;">{{ '{}/{}'.format(row['Place'], row['num_racers']) if row['Place'] else 'DNF' }}</td>
                  </tr>
                  {% endfor %}
                  <!-- <tr>
                    <th style="text-align: center; width: 10%;" scope="row">-</th>
                    <th style="text-align: center; width: 20%;" scope="row">-</th>
                    <td style="width: 30%;">Initial rating</td>
                    <td style="width: 20%;"></td>
                    <td style="text-align: center; width: 10%;"></td>
                  </tr> -->
                </tbody>
              </table>
            </div>
          </div>
          <br>
          <div class="col-lg-8 mx-auto text-center">
            <div id='racer-plot'></div>
          </div>
        </div>
        <div class="col-lg-10 mx-auto">
          <b>What does this plot mean?</b>
          <ul>
            <li>The connected black markers track the racer's average skill rating over time (hover to see race details).
            <li>The dashed line represents the average skill rating, considering all racers. Hopefully the racer you selected is rated higher!</li>
            <li>The shaded band represents a range of skill ratings that considers the uncertainty of the rating system.</li>
            <li>The uncertaintly generally narrows as each racer achieves consistent results in a series of races.</li>
            <li>Use the scroll wheel to zoom in; double click to reset.</li>
          </ul>
        </div>
      </div>
    </div>
  </section>


  <section id="trueskill">
    <div class="container">
      <div class="row">
        <div class="col-lg-10 mx-auto">
          <h2 style="text-align: center;">Learn about the rating system</h2>
          <b>What is TrueSkill™ and how does it work?</b>
          <ul>
            <li>
              BikeRank assigns a rating to each racer using the TrueSkill™ Ranking System.
              For detailed technical information, please see <a href="https://www.microsoft.com/en-us/research/project/trueskill-ranking-system/">Microsoft's official page.</a>
            </li>
            <li>
              The key principle behind TrueSkill™ is that each racer's performance is expected to vary between races, following a normal distribution.
              The mean μ of this distribution is the racer's "skill", and the standard deviation σ describes both the
              intrinsic variability and the uncertainty in the system's assessment of the racer's performance.
            </li>
            <div style="text-align:center;">
              <img src="static/plots/normal.png">
            </div>
            <li>
              Using <a href="https://en.wikipedia.org/wiki/Bayesian_inference">Bayesian inference</a>,
              the system updates each racer's rating over time, evaluating the probability of the race outcome given the prior performance of all racers involved.
            </li>
            <li>
              Applying TrueSkill using a default μ = 25 and σ = 25/3, we obtain the following distribution of ratings for all racers:
            </li>
            <div style="text-align:center;">
              <img src="static/plots/ratings.png">
            </div>
          </ul>
          <b>Are the ratings valid?</b>
          <ul>
            <li>To evaluate the validity of the model, we consider the
              <a href="https://en.wikipedia.org/wiki/Spearman%27s_rank_correlation_coefficient">Spearman correlation</a>
              between the prior μ and final placing for a list of racers.</li>
            <li>This metric essentially evaluates the relationship between the Predicted and Actual Place columns, and is reported along with the race table <a class="js-scroll-trigger" href="#race">above</a>.</li>
            <li>The Spearman correlation has a value of -1 if the predicted placing is perfect, and a value of 1 if the predicted placing is completely wrong.</li>
            <li>The plot below is a histogram of the Spearman correlation for all races consisting of at least 5 racers.</li>
            <div style="text-align:center;">
              <img src="static/plots/correlation.png">
            </div>
            <li>BikeRank makes reasonable predictions! The Spearman correlation is negative for 96% of races with at least 5 racers (mean: -0.475, median: -0.510, standard deviation: 0.286).</li>
          </ul>
        </div>
      </div>
    </div>
  </section>


  <section id="contact" class="bg-light">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 text-center mx-auto">
          <h2>Contact the author</h2>
        </div>
          <div class="container text-center">

            <p class="lead">This website was created by Brian Schaefer for
              <a href="https://www.thedataincubator.com/">The Data Incubator</a>
              <br>September-November 2020
            </p>
            <img src="static/headshot.jpg" class="headshot">
            <div class="social-links">
              <a href="https://github.com/physinet/road-results" class="github"><i class="bx bxl-github"></i></a>
              <a href="https://www.linkedin.com/in/brian-schaefer-999683190/" class="linkedin"><i class="bx bxl-linkedin"></i></a>
            </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Bootstrap core JavaScript -->
  <script src="{{ url_for('static', filename='vendor/jquery/jquery.min.js') }}"></script>
  <script src="{{ url_for('static', filename='vendor/bootstrap/js/bootstrap.bundle.min.js') }}"></script>

  <!-- Plugin JavaScript -->
  <script src="{{ url_for('static', filename='vendor/jquery-easing/jquery.easing.min.js') }}"></script>

  <!-- Custom JavaScript for this theme -->
  <script src="{{ url_for('static', filename='js/scrolling-nav.js') }}"></script>

  <!-- Altair racer plot -->
  <script>
        var spec = {{ racer_plot | safe }};
        vegaEmbed("#racer-plot", spec);
  </script>


</body>

</html>
