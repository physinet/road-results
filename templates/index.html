<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>BikeRank</title>

  <!-- Bootstrap core CSS -->
  <link href="{{ url_for('static', filename='vendor/bootstrap/css/bootstrap.min.css') }}" rel="stylesheet">
  <link href="{{ url_for('static', filename='vendor/boxicons/css/boxicons.min.css') }}" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="{{ url_for('static', filename='css/scrolling-nav.css') }}" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.devbridge-autocomplete/1.2.26/jquery.autocomplete.min.js"></script>

<!-- For altair -->

 <script src="https://cdn.jsdelivr.net/npm/vega@5.17.0"></script>
 <script src="https://cdn.jsdelivr.net/npm/vega-lite@4.17.0"></script>
 <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.12.2"></script>

  <script>
    document.location.hash = '#' + '{{ scroll }}';
  </script>

  <!-- Icon -->
  <link href="data:image/x-icon;base64,AAABAAEAEBAAAAAAAABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABYZHesXGh//Fxof/xcaH/4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAXGh/+Fxof/xcaH/8WGR3rAAAAABYZHvUAAAAAAAAAAAAAAAAAAAAAFxof/wAAAAAAAAAAAwMEFAAAAAAXGh//AAAAAAAAAAAAAAAAAAAAABYZHvUXGh//AAAAAAAAAAAAAAAAAAAAAA8RFZcAAAAAAAAAABcaH/8XGh//Fxof/w8RFZIAAAAAAAAAAAAAAAAXGh//Fxof/wAAAAAAAAAAFxof/wAAAAASFBiwAAAAABcaH/8UFxvaAAAAABETF6QAAAAAFxof/wAAAAAAAAAAFxof/xUXHNkAAAAAAAAAAAAAAAAXGh/+Fxof/xcaH/8AAAAAAAAAABYZHukXGh//DhIVhAAAAAAAAAAAAAAAABUXHNkAAAAAERMXnhcaH/8XGh//Fxof/hcaH/8AAAAAAAAAAAAAAAAXGh//AAAAABYZHvwXGh//Fxof/xETFp4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAXGR7yFxoe8RUYHfAVGB3uFRgd7g0OEnUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFxof/wAAAAAAAAAAAAAAABcaH/8XGh//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABcaH/4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AAD//wAA//8AAIfhAAB73gAAew4AAGpWAABxjgAAg6EAAPg/AAD7nwAA+/8AAP//AAD//wAA//8AAA==" rel="icon" type="image/x-icon" />
  </head>

<body id="page-top">

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" id="mainNav">
    <div class="container">
      <a class="navbar-brand js-scroll-trigger" href="#page-top">BikeRank</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#race">Find a race</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#racer">Find a racer</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#trueskill">About the ratings</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#contact">Contact</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>


  <header class="jumbotron jumbotron-fluid text-white" style="margin: 0; background: url('static/background.jpg') no-repeat center; background-size: cover;">
    <br>
    <br>
    <br>

    <div class="container text-center col-lg-6" style="-moz-border-radius:10px; -webkit-border-radius:10px; border-radius:10px; background: #000; background-color: rgba(0,0,0,0.5)">
      <br>
      <br>
      <h1>BikeRank</h1>
      <h3>Skill ratings for amateur road cyclists</h3>
      <br>
      <p class="lead">Explore your racing history</p>
      <p class="lead">Visualize your progress</p>
      <p class="lead">Get to know your competition</p>
      <p class="lead">Anticipate your results</p>
      <br>
      <br>

    </div>
  </header>

  <section id="data" class="bg-light">



    <div class="container">
      <div class="container text-center col-lg-12">
        <h2>Place isn't everything</h2>
        <p style="font-size: 14pt;">
          BikeRank uses the <a href="https://www.microsoft.com/en-us/research/project/trueskill-ranking-system/">
          TrueSkill™ Ranking System</a>
          to analyze the results of amateur road cycling races.
          <br>
          With each new race, BikeRank updates the skill ratings for each racer considering the entire racing history of the field.
          <br>
          Place is just a number - BikeRank reveals each racer's skill.
        </p>
      </div>
      <br>
      <div class="row text-center">
        <div class="col">
        <div class="numberview">
        <h2 class="timer numberview-title numberview-number">>12,000</h2>
        <p class="numberview-text ">Races</p>
      </div>
      </div>
      <div class="col">
        <div class="numberview">
          <h2 class="timer numberview-title numberview-number">>190,000</h2>
          <p class="numberview-text ">Racers</p>
        </div>
      </div>
      <div class="col">
        <div class="numberview">
          <h2 class="timer numberview-title numberview-number">>2,400,000</h2>
          <p class="numberview-text ">Results</p>
        </div>
      </div>
     </div>
     <br>
     <div class="container text-center col-lg-12">
       <img src="https://results.bikereg.com/img/bikeRegLogo.png" class=".mx-auto .d-block" style="height:50px;">
       <img src="https://results.bikereg.com/img/roadresultslogo_notag.png" class=".mx-auto .d-block" style="height:50px;">
      </div>
    </div>
    <br>
    <div class="container text-center col-lg-12" style="font-size: 14pt;">
      Using 15 years of race results in the United States from <a href="https://www.road-results.com/">https://www.road-results.com/</a>
    </div>

  </section>


    <section id="race">
      <div class="container">
        <div class="col-lg-10 mx-auto text-center">
          <h2>Find a race</h2>
          Enter <a href="https://results.bikereg.com/race/11456">BikeReg race page</a> URL:
          <div class="container text-center">
            <form method="POST">
              {{ race_form.name_date(size=70) }}
              {{ race_form.submit }}
              <script>
              $('#name_date').autocomplete({
                  serviceUrl: '/search/race_name',
                  dataType: 'json',
                  lookupLimit: 5,
                  minChars: 3,
                  onSearchComplete: function (query, suggestions) {
                    console.log(query);
                  }
              });
              </script>
            </form>
            <form method="POST">
              {{ category_form.category }}
              {{ category_form.submit }}
            </form>
          </div>



          <br>
          <h5 style="text-align: center">
            {{ race_table[0]['RaceName'] }} • May 19, 2019
            <br>
            Category: {{ race_table[0]['RaceCategoryName'] }}
          </h5>
            <div class="table" style="margin-bottom:300px;">
              <table class="table table-bordered table-sm table-hover table-scroll">
                <thead class="thead-dark">
                  <tr>
                    <th style="text-align: center; width: 15%" scope="col">Name</th>
                    <th style="text-align: center; width: 25%" scope="col">Team</th>
                    <th style="text-align: center; width: 10%" scope="col">Rating</th>
                    <th style="text-align: center; width: 10%" scope="col">Predicted Place</th>
                    <th style="text-align: center; width: 10%" scope="col">Actual Place</th>
                    <th style="text-align: center; width: 10%" scope="col">Adjusted Rating</th>
                    <th style="text-align: center; width: 10%" scope="col">Rating Change</th>
                  </tr>
                </thead>
                <tbody>
                  {% for row in race_table %}
                  <tr>
                    <td style="text-align: center; width: 15%;">{{ row['Name'] }}</td>
                    <td style="text-align: center; width: 25%;">{{ row['TeamName'] }}</td>
                    <td style="text-align: center; width: 10%;">
                      {% if row['prior_mu'] is not none %}
                        {{ '%.2f, %.2f' | format(row['prior_mu'], row['prior_sigma']) }}
                      {% else %}
                        NONE
                      {% endif %}
                    </td>
                    <td style="text-align: center; width: 10%;">{{ row['predicted_place'] }}</td>
                    <td style="text-align: center; width: 10%;">{{ row['Place'] }}</td>
                    <td style="text-align: center; width: 10%;">
                      {% if row['new_mu'] is not none %}
                        {{ '%.2f, %.2f' | format(row['new_mu'], row['new_sigma']) }}
                      {% else %}
                        NONE
                      {% endif %}
                    </td>
                    <td style="text-align: center; width: 10%;">
                      {% if row['prior_mu'] is not none %}
                        {{ '%.2f, %.2f' | format(row['new_mu'] - row['prior_mu'], row['new_sigma'] - row['prior_sigma']) }}
                      {% else %}
                        NONE
                      {% endif %}
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
          </div>
        </div>
      </div>
    </section>

  <section id="racer"   class="bg-light">
    <div class="container">
      <div class="row">
        <div class="col-lg-10 mx-auto text-center">
          <h2>Find a racer</h2>
          Enter <a href="https://results.bikereg.com/race/11456">BikeReg racer page</a> URL:

          <form method="POST">
            <input size="50" type="text" name="racer_url" id="racer_url" placeholder="https://results.bikereg.com/racer/177974">
            <input type="submit">
          </form>
        </div>
      </div>
      <div class="container">
        <div class="col-lg-10 mx-auto">
          <h5 style="text-align: center"><br>Race history for {{ racer_name }}:</h5>
          <div class="table-responsive" style="margin-bottom:400px;">
            <table class="table table-bordered table-sm table-hover table-scroll">
              <thead class="thead-dark">
                <tr>
                  <th style="text-align: center; width: 10%" scope="col">#</th>
                  <th style="text-align: center; width: 20%" scope="col">Date</th>
                  <th style="text-align: center; width: 30%" scope="col">Race Name</th>
                  <th style="text-align: center; width: 20%" scope="col">Category</th>
                  <th style="text-align: center; width: 10%" scope="col">Place</th>
                </tr>
              </thead>
              <tbody>
                {% for row in racer_table %}
                <tr>
                  <th style="text-align: center; width: 10%;" scope="row">{{ loop.index }}</th>
                  <th style="text-align: center; width: 20%;" scope="row">{{ row['date'].strftime('%B %d, %Y') }}</th>
                  <td style="width: 30%;">{{ row['RaceName'] }}</td>
                  <td style="width: 20%;">{{ row['RaceCategoryName'] }}</td>
                  <td style="text-align: center; width: 10%;">{{ row['Place'] }} / {{ row['num_racers'] }}</td>
                </tr>
                {% endfor %}
              </tbody>
              <!-- <tbody>
                {% for i, row in df_racer[::-1].iterrows() %}
                <tr>
                  <th style="text-align: center; width: 10%;" scope="row">{{ loop.index }}</th>
                  <th style="text-align: center; width: 20%;" scope="row">{{ row['RaceDate'].strftime('%B %d, %Y') }}</th>
                  <td style="width: 30%;">{{ row['RaceName'] }}</td>
                  <td style="width: 20%;">{{ row['RaceCategoryName'] }}</td>
                  <td style="text-align: center; width: 10%;">{{ row['Place'] }}</td>
                </tr>
                {% endfor %}
              </tbody> -->
            </table>
          </div>
        </div>
        <br>
        <div class="col-lg-8 mx-auto text-center">
          <div id='racer-plot'></div>
        </div>
      </div>
    </div>
  </section>


  <section id="trueskill">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 mx-auto">
          <h2 style="text-align: center;">Learn about the rating system</h2>
          <ul>
            <li>
              BikeRank assigns a rating to each racer using the
              <a href="https://www.microsoft.com/en-us/research/project/trueskill-ranking-system/">
                TrueSkill™ Ranking System</a> developed by Microsoft for multiplayer online gaming.
            </li>
            <li>
              TrueSkill™ uses <a href="https://en.wikipedia.org/wiki/Bayesian_inference">Bayesian inference</a>
              to update each racer's rating over time, comparing their skill level to that
              of the other racers and evaluating the probability of the race outcome.
            </li>
            <li>
              Each racer's "performance" is expected to vary from race to race following a normal distribution.
              The mean μ of this distribution is the racer's "skill", and the standard deviation σ describes both the
              intrinsic variability and the uncertainty in the system's assessment of the racer's performance.
            </li>
            <div class="plot">
              <img src="static/plots/normal.png">
            </div>
            <!-- <li>
              Consider a race between two equally-rated individuals. The winner's skill rating
              increases, while the loser's rating decreases by the same amount.
              The performance distribution for each racer narrows, because the system
              now knows more about both racers.
            </li>
            <div class="plot">
              <img src="static/plots/2racers.png">
            </div>
            <li>
              If the racers race again and the winner claims a second victory, the skill ratings
              change in the same direction, but by a lesser amount. A skill gap has opened,
              so the winner's victory can be anticipated.
            </li>
            <div class="plot">
              <img src="static/plots/2racers2.png">
            </div> -->
            <li>
              A race between three racers.
            </li>
            <div class="plot">
              <img src="static/plots/3racers.png">
            </div>
            <!-- <li>
              Now consider a race between two individuals with different ratings.
              If the racer with the higher rating wins, th
              Consider a race between two equally-rated individuals. The winner's skill rating
              increases, while the loser's rating decreases by the same amount.
              The performance distribution for each racer narrows, because the system
              now knows more about both racers.
            </li>
            <div class="plot">
              <img src="static/plots/2diffracers.png">
            </div>
          </ul> -->

        </div>
      </div>
    </div>
  </section>


  <section id="contact" class="bg-light">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 text-center mx-auto">
          <h2>Contact the author</h2>
          <div class="container text-center">

            <p class="lead">This website was created by Brian Schaefer for
              <a href="https://www.thedataincubator.com/">The Data Incubator</a>
              <br>September-November 2020
            </p>
            <img src="static/headshot.jpg" class="headshot">
            <div class="social-links">
              <a href="https://github.com/physinet/road-results" class="github"><i class="bx bxl-github"></i></a>
              <a href="https://www.linkedin.com/in/brian-schaefer-999683190/" class="linkedin"><i class="bx bxl-linkedin"></i></a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Bootstrap core JavaScript -->
  <script src="{{ url_for('static', filename='vendor/jquery/jquery.min.js') }}"></script>
  <script src="{{ url_for('static', filename='vendor/bootstrap/js/bootstrap.bundle.min.js') }}"></script>

  <!-- Plugin JavaScript -->
  <script src="{{ url_for('static', filename='vendor/jquery-easing/jquery.easing.min.js') }}"></script>

  <!-- Custom JavaScript for this theme -->
  <script src="{{ url_for('static', filename='js/scrolling-nav.js') }}"></script>

  <!-- Altair racer plot -->
  <script>
        var spec = {{ chart | safe }};
        vegaEmbed("#racer-plot", spec);
  </script>


</body>

</html>
