<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>BikeRank</title>

  <!-- Bootstrap core CSS -->
  <link href="{{ url_for('static', filename='vendor/bootstrap/css/bootstrap.min.css') }}" rel="stylesheet">
  <link href="{{ url_for('static', filename='vendor/boxicons/css/boxicons.min.css') }}" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="{{ url_for('static', filename='css/scrolling-nav.css') }}" rel="stylesheet">


  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.devbridge-autocomplete/1.2.26/jquery.autocomplete.min.js"></script>
  <script src="https://cdn.bokeh.org/bokeh/release/bokeh-2.2.1.min.js" crossorigin="anonymous"></script>

  <script>
    document.location.hash = '#' + '{{ scroll }}';
  </script>

</head>

<body id="page-top">

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" id="mainNav">
    <div class="container">
      <a class="navbar-brand js-scroll-trigger" href="#page-top">BikeRank</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#data">Data</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#racer">Find a racer</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#revisit">Revisit a race</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#trueskill">Ratings</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#contact">Contact</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>


  <header class="jumbotron jumbotron-fluid text-white" style="margin: 0; background: url('static/background.jpg') no-repeat center; background-size: cover;">
    <br>
    <br>
    <br>

    <div class="container text-center col-lg-6" style="-moz-border-radius:10px; -webkit-border-radius:10px; border-radius:10px; background: #000; background-color: rgba(0,0,0,0.5)">
      <br>
      <br>
      <h1>BikeRank</h1>
      <h3>Skill ratings for amateur road cyclists</h3>
      <br>
      <p class="lead">Explore your racing history</p>
      <p class="lead">Visualize your progress</p>
      <p class="lead">Get to know your competition</p>
      <p class="lead">Anticipate your results</p>
      <br>
      <br>

    </div>
  </header>

  <section id="data" class="bg-light">



    <div class="container">
      <div class="container text-center col-lg-12">
        <img src="https://results.bikereg.com/img/bikeRegLogo.png" class=".mx-auto .d-block" style="height:50px;">
        <img src="https://results.bikereg.com/img/roadresultslogo_notag.png" class=".mx-auto .d-block" style="height:50px;">
      </div>
      <br>
      <div class="row text-center">
        <div class="col">
        <div class="numberview">
        <h2 class="timer numberview-title numberview-number">12,000</h2>
        <p class="numberview-text ">Races</p>
      </div>
      </div>
      <div class="col">
        <div class="numberview">
          <h2 class="timer numberview-title numberview-number">190,000</h2>
          <p class="numberview-text ">Racers</p>
        </div>
      </div>
      <div class="col">
        <div class="numberview">
          <h2 class="timer numberview-title numberview-number">24,000,000</h2>
          <p class="numberview-text ">Results</p>
        </div>
      </div>
     </div>
    </div>


    <!-- <div class="container">
      <div class="row">
        <div class="col-lg-8 mx-auto">

          <ul>
            <li>> 12,000 races</li>
            <li>> 190,000 racers</li>
            <li>> 2.4 million results</li>
          </ul>
          <h5 style="text-align: center">1273 races in 2019</h5>
          <iframe class="map" src="/map" width="800" height="600"></iframe>
        </div>
      </div>
    </div> -->
  </section>

  <section id="racer">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 mx-auto">
          <h2>Find a racer</h2>
          <ul>
            <li>Search for a racer on <a href="https://results.bikereg.com/?n=racers&sn=find">BikeReg</a>.</li>
            <li>Navigate to the racer's <a href="https://results.bikereg.com/racer/177974">summary page</a>.</li>
            <li>Copy the URL from the address bar, paste below, and submit</a>.</li>
          </ul>

          <form method="POST">
            <input size="50" type="text" name="racer_url" id="racer_url" placeholder="https://results.bikereg.com/racer/177974">
            <input type="submit">
          </form>
        </div>
      </div>
      <div class="container">
        <div class="col-lg-8 mx-auto">
          <h5 style="text-align: center"><br>Race history for {{ df_racer['FirstName'][0] + ' ' + df_racer['LastName'][0] }}:</h5>
          <div class="table-responsive" style="margin-bottom:400px;">
            <table class="table table-bordered table-sm table-hover table-scroll">
              <thead class="thead-dark">
                <tr>
                  <th style="text-align: center; width: 10%" scope="col">#</th>
                  <th style="text-align: center; width: 20%" scope="col">Date</th>
                  <th style="text-align: center; width: 30%" scope="col">Race Name</th>
                  <th style="text-align: center; width: 20%" scope="col">Category</th>
                  <th style="text-align: center; width: 10%" scope="col">Place</th>
                </tr>
              </thead>
              <tbody>
                {% for i, row in df_racer[::-1].iterrows() %}
                <tr>
                  <th style="text-align: center; width: 10%;" scope="row">{{ loop.index }}</th>
                  <th style="text-align: center; width: 20%;" scope="row">{{ row['RaceDate'].strftime('%B %d, %Y') }}</th>
                  <td style="width: 30%;">{{ row['RaceName'] }}</td>
                  <td style="width: 20%;">{{ row['RaceCategoryName'] }}</td>
                  <td style="text-align: center; width: 10%;">{{ row['Place'] }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
        <br>
        <div class="col-lg-8 mx-auto">
          {{ div | safe }} <!-- Double { for flask -->
          {{ script | safe }} <!-- Safe says include this as html in the output. Normally would protect from other users putting in their own js -->
        </div>
      </div>
      <!-- <select>
        {% for item in race_list %}
          <option value="{{item}}">{{item}}</option>
        {% endfor %}
      </select> -->


      <!-- <form action='select_race' method="POST">
        {{ form.hidden_tag() }}
        <div style="width: 220px">
          {{ form.name }}
        </div>
        <button>Submit</button>
      </form> -->

      <!-- <script>
      $(document).ready(function() {
          $('#name').select2({  // init Select2 on form's name field
              placeholder: "{{ form.name.label.text }}",
              allowClear: true,
              "width": "style"
          });
      });
      </script> -->

      <!-- <div class="container text-center">
      <h2> Enter race name: </h2>
        <form method="POST">
          <input type="text" name="race_name" id="autocomplete1" placeholder="Bucknell Cycling Classic">
          <input type="submit">

          <script>
          $('#autocomplete1').autocomplete({
              serviceUrl: '/search/race_name',
              dataType: 'json',
              lookupLimit: 10,
              minChars: 1,
              onSearchComplete: function (query, suggestions) {
                console.log(query);
              }
          });
          </script>
        </form>
      </div> -->
    </div>
  </section>


  <section id="revisit"  class="bg-light">
    <div class="container">
      <div class="col-lg-8 mx-auto">
        <h2>Find a race</h2>
        <ul>
          <li>Search for a race on <a href="https://results.bikereg.com/?n=results&sn=all">BikeReg</a>.</li>
          <li>Navigate to the race <a href="https://results.bikereg.com/race/11456">summary page</a>.</li>
          <li>Copy the URL from the address bar, paste below, and submit</a>.</li>
        </ul>
        <form method="POST">
          <input size="50" type="text" name="race_url" id="race_url" placeholder="https://results.bikereg.com/race/11456">
          <input type="submit">
        </form>
        <h5 style="text-align: center">Race recap for {{ df['RaceName'].values[0] }}:</h5>
        <div class="table-responsive" style="margin-bottom:300px;">
          <table class="table table-bordered table-sm table-hover table-scroll">
            <thead class="thead-dark">
              <tr>
                <th style="text-align: center; width: 25%" scope="col">Name</th>
                <th style="text-align: center; width: 30%" scope="col">Team</th>
                <th style="text-align: center; width: 15%" scope="col">Predicted<br>Place</th>
                <th style="text-align: center; width: 15%" scope="col">Actual<br>Place</th>
                <th style="text-align: center; width: 15%" scope="col">Rating<br>Change</th>
              </tr>
            </thead>
            <tbody>
              {% for i, row in df.iterrows() %}
              <tr>
                <td style="width: 25%;">{{ row['FirstName'] + ' ' + row['LastName'] }}</td>
                <td style="width: 30%;">{{ row['TeamName'] }}</td>
                <td style="text-align: center; width: 15%;">{{ row['PredictedPlace'] }}</td>
                <td style="text-align: center; width: 15%;">{{ loop.index }}</td>
                <td style="text-align: center; width: 15%;">{{ '%.2f' | format(-row['Points'] + row['PriorPoints']) }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

  <section id="trueskill">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 mx-auto">
          <h2>Learn about the rating system</h2>
          <ul>
            <li>
              BikeRank assigns a rating to each racer using the
              <a href="https://www.microsoft.com/en-us/research/project/trueskill-ranking-system/">
                TrueSkill™ Ranking System</a> developed by Microsoft for multiplayer online gaming.
            </li>
            <li>
              TrueSkill™ uses <a href="https://en.wikipedia.org/wiki/Bayesian_inference">Bayesian inference</a>
              to update each racer's rating over time, comparing their skill level to that
              of the other racers and evaluating the probability of the race outcome.
            </li>
            <li>
              Each racer's "performance" is expected to vary from race to race following a normal distribution.
              The mean μ of this distribution is the racer's "skill", and the standard deviation σ describes both the
              intrinsic variability and the uncertainty in the system's assessment of the racer's performance.
            </li>
            <div class="plot">
              <img src="static/plots/normal.png">
            </div>
            <!-- <li>
              Consider a race between two equally-rated individuals. The winner's skill rating
              increases, while the loser's rating decreases by the same amount.
              The performance distribution for each racer narrows, because the system
              now knows more about both racers.
            </li>
            <div class="plot">
              <img src="static/plots/2racers.png">
            </div>
            <li>
              If the racers race again and the winner claims a second victory, the skill ratings
              change in the same direction, but by a lesser amount. A skill gap has opened,
              so the winner's victory can be anticipated.
            </li>
            <div class="plot">
              <img src="static/plots/2racers2.png">
            </div> -->
            <li>
              A race between three racers.
            </li>
            <div class="plot">
              <img src="static/plots/3racers.png">
            </div>
            <!-- <li>
              Now consider a race between two individuals with different ratings.
              If the racer with the higher rating wins, th
              Consider a race between two equally-rated individuals. The winner's skill rating
              increases, while the loser's rating decreases by the same amount.
              The performance distribution for each racer narrows, because the system
              now knows more about both racers.
            </li>
            <div class="plot">
              <img src="static/plots/2diffracers.png">
            </div>
          </ul> -->

        </div>
      </div>
    </div>
  </section>


  <section id="contact" class="bg-light">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 text-center mx-auto">
          <h2>Contact the author</h2>
          <div class="container text-center">

            <p class="lead">This website was created by Brian Schaefer for
              <a href="https://www.thedataincubator.com/">The Data Incubator</a>
              <br>September-November 2020
            </p>
            <img src="static/headshot.jpg" class="headshot">
            <div class="social-links">
              <a href="https://github.com/physinet/road-results" class="github"><i class="bx bxl-github"></i></a>
              <a href="https://www.linkedin.com/in/brian-schaefer-999683190/" class="linkedin"><i class="bx bxl-linkedin"></i></a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Bootstrap core JavaScript -->
  <script src="{{ url_for('static', filename='vendor/jquery/jquery.min.js') }}"></script>
  <script src="{{ url_for('static', filename='vendor/bootstrap/js/bootstrap.bundle.min.js') }}"></script>

  <!-- Plugin JavaScript -->
  <script src="{{ url_for('static', filename='vendor/jquery-easing/jquery.easing.min.js') }}"></script>

  <!-- Custom JavaScript for this theme -->
  <script src="{{ url_for('static', filename='js/scrolling-nav.js') }}"></script>

</body>

</html>
